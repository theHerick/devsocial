<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevConsole - Social Network for Developers</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #c9d1d9;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .console-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .console-header {
            border-bottom: 1px solid #30363d;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .console-title {
            color: #58a6ff;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .console-subtitle {
            color: #7d8590;
            font-size: 12px;
        }

        .console-output {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .console-input-container {
            display: flex;
            align-items: center;
            border-top: 1px solid #30363d;
            padding-top: 10px;
        }

        .console-prompt {
            color: #7c3aed;
            margin-right: 10px;
            font-weight: bold;
        }

        .console-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #c9d1d9;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }

        .output-line {
            margin-bottom: 8px;
            padding: 2px 0;
        }

        .output-error {
            color: #f85149;
        }

        .output-success {
            color: #56d364;
        }

        .output-info {
            color: #58a6ff;
        }

        .output-warning {
            color: #f0883e;
        }

        .auth-form {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            max-width: 400px;
            margin: 20px auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: #f0f6fc;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .form-input {
            width: 100%;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 4px;
            padding: 8px 10px;
            color: #c9d1d9;
            font-family: inherit;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #58a6ff;
        }

        .form-button {
            background: #238636;
            border: none;
            border-radius: 4px;
            color: white;
            padding: 8px 16px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
        }

        .form-button:hover {
            background: #2ea043;
        }

        .hidden {
            display: none;
        }

        /* Scrollbar styling */
        .console-output::-webkit-scrollbar {
            width: 8px;
        }

        .console-output::-webkit-scrollbar-track {
            background: #161b22;
        }

        .console-output::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        .console-output::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
    </style>
</head>
<body>
    <div class="console-container">
        <div class="console-header">
            <div class="console-title">DevConsole v1.0.0</div>
            <div class="console-subtitle">Social Network for Developers</div>
        </div>

        <!-- Login/Register Section -->
        <div id="authSection" class="auth-form">
            <div id="loginForm">
                <h3 style="color: #58a6ff; margin-bottom: 20px; text-align: center;">Login</h3>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email:</label>
                        <input type="email" class="form-input" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password:</label>
                        <input type="password" class="form-input" id="loginPassword" required>
                    </div>
                    <button type="submit" class="form-button">Login</button>
                    <button type="button" class="form-button" onclick="showRegisterForm()">Create Account</button>
                </form>
            </div>

            <div id="registerForm" class="hidden">
                <h3 style="color: #58a6ff; margin-bottom: 20px; text-align: center;">Register</h3>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label class="form-label" for="regEmail">Email:</label>
                        <input type="email" class="form-input" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="regPassword">Password:</label>
                        <input type="password" class="form-input" id="regPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="regUsername">Username:</label>
                        <input type="text" class="form-input" id="regUsername" required>
                    </div>
                    <button type="submit" class="form-button">Register</button>
                    <button type="button" class="form-button" onclick="showLoginForm()">Back to Login</button>
                </form>
            </div>
        </div>

        <!-- Main App Section (hidden initially) -->
        <div id="mainApp" class="hidden">
            <div class="console-output" id="output">
                <div class="output-line output-success">Welcome to DevConsole! You are now logged in.</div>
            </div>

            <div class="console-input-container">
                <span class="console-prompt" id="prompt">user@devconsole:~$</span>
                <input type="text" class="console-input" id="commandInput" placeholder="Type a command..." autocomplete="off">
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration (same as PokePoint)
        const firebaseConfig = {
            apiKey: "AIzaSyAexCf7hPN2OQvfsw66UDpci6nycivrK98",
            authDomain: "void-activation-system.firebaseapp.com",
            databaseURL: "https://void-activation-system-default-rtdb.firebaseio.com",
            projectId: "void-activation-system",
            storageBucket: "void-activation-system.firebasestorage.app",
            messagingSenderId: "108268095097",
            appId: "1:108268095097:web:4f45ff75a9e528b3f0f6a8",
            measurementId: "G-P71BZFRDQB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;

        // Collection names
        const USERS_COLLECTION = 'devsocial-users';
        const POSTS_COLLECTION = 'devsocial-posts';

        // UI Functions
        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        function showMainApp() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            updatePrompt();
            loadPosts();
        }

        function showAuthSection() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authSection').classList.remove('hidden');
        }

        function updatePrompt() {
            const prompt = document.getElementById('prompt');
            if (currentUser) {
                prompt.textContent = `${currentUser.displayName || currentUser.email}@devconsole:~$`;
            } else {
                prompt.textContent = 'guest@devconsole:~$';
            }
        }

        // Authentication
        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                console.log('User logged in:', user.email);
                showMainApp();
            } else {
                console.log('User logged out');
                showAuthSection();
            }
        });

        // Login Form Handler
        document.getElementById('loginFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Logging in...';
            submitBtn.disabled = true;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    addOutput('‚úÖ Login successful!', 'success');
                    this.reset();
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    addOutput(`‚ùå Login failed: ${error.message}`, 'error');
                })
                .finally(() => {
                    submitBtn.textContent = 'Login';
                    submitBtn.disabled = false;
                });
        });

        // Register Form Handler
        document.getElementById('registerFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const username = document.getElementById('regUsername').value;
            
            if (username.length < 2) {
                alert('Username must be at least 2 characters long.');
                return;
            }
            
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.textContent = 'Creating account...';
            submitBtn.disabled = true;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Update user profile with username
                    return user.updateProfile({
                        displayName: username
                    }).then(() => {
                        // Create user document in Firestore
                        return db.collection(USERS_COLLECTION).doc(user.uid).set({
                            username: username,
                            email: email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            postCount: 0
                        });
                    });
                })
                .then(() => {
                    alert('Account created successfully!');
                    this.reset();
                    showLoginForm();
                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    alert(`Registration failed: ${error.message}`);
                })
                .finally(() => {
                    submitBtn.textContent = 'Register';
                    submitBtn.disabled = false;
                });
        });

        // Output functions
        function addOutput(text, type = '') {
            const output = document.getElementById('output');
            if (!output) return;
            
            const line = document.createElement('div');
            line.className = `output-line ${type ? 'output-' + type : ''}`;
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        // Command system
        const commandInput = document.getElementById('commandInput');
        
        if (commandInput) {
            commandInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const command = this.value.trim();
                    if (command) {
                        handleCommand(command);
                        this.value = '';
                    }
                }
            });
        }

        function handleCommand(command) {
            addOutput(`${document.getElementById('prompt').textContent} ${command}`);
            
            const [cmd, ...args] = command.split(' ');
            
            switch (cmd) {
                case 'help':
                    showHelp();
                    break;
                case 'logout':
                    logout();
                    break;
                case '/post':
                    if (args.length === 0) {
                        addOutput('‚ùå Usage: /post {title}; {description};', 'error');
                        addOutput('Example: /post Hello World **bold**; This is my first post __underline__;', 'info');
                    } else {
                        createPostWithFormat(args.join(' '));
                    }
                    break;
                case 'post':
                    if (args.length === 0) {
                        addOutput('‚ùå Usage: post <message>', 'error');
                    } else {
                        createPost(args.join(' '));
                    }
                    break;
                case 'posts':
                    loadPosts();
                    break;
                case 'like':
                    if (args.length === 0) {
                        addOutput('‚ùå Usage: like <post_id>', 'error');
                    } else {
                        likePost(args[0]);
                    }
                    break;
                case 'comment':
                    if (args.length < 2) {
                        addOutput('‚ùå Usage: comment <post_id> <message>', 'error');
                    } else {
                        const postId = args[0];
                        const commentText = args.slice(1).join(' ');
                        addComment(postId, commentText);
                    }
                    break;
                case 'clear':
                    clearOutput();
                    break;
                default:
                    addOutput(`‚ùå Unknown command: ${cmd}. Type 'help' for available commands.`, 'error');
            }
        }

        function showHelp() {
            addOutput('Available commands:', 'info');
            addOutput('  help - Show this help message');
            addOutput('  /post {title}; {description}; - Create post with title and description');
            addOutput('  post <message> - Create simple post');
            addOutput('  posts - Load recent posts');
            addOutput('  like <post_id> - Like/unlike a post');
            addOutput('  comment <post_id> <message> - Add comment to post');
            addOutput('  logout - Logout from the system');
            addOutput('  clear - Clear the console');
            addOutput('');
            addOutput('Post formatting:', 'info');
            addOutput('  **bold** - Bold text');
            addOutput('  __underline__ - Underlined text');
            addOutput('  Example: /post Hello **World**; This is my __first__ post;');
        }

        function logout() {
            auth.signOut().then(() => {
                addOutput('üëã Logged out successfully!', 'success');
                clearOutput();
            });
        }

        function clearOutput() {
            const output = document.getElementById('output');
            if (output) {
                output.innerHTML = '';
            }
        }

        // Posts functions
        function createPostWithFormat(input) {
            if (!currentUser) {
                addOutput('‚ùå You must be logged in to post.', 'error');
                return;
            }
            
            console.log('Creating post with format:', input);
            
            // Parse format: {title}; {description};
            const parts = input.split(';').map(part => part.trim());
            
            if (parts.length < 2 || !parts[0] || !parts[1]) {
                addOutput('‚ùå Invalid format. Use: /post {title}; {description};', 'error');
                addOutput('Example: /post Hello World; This is my first post;', 'info');
                return;
            }
            
            const title = parts[0];
            const description = parts[1];
            
            // Process formatting
            const processedTitle = processTextFormatting(title);
            const processedDescription = processTextFormatting(description);
            
            addOutput('üìù Creating post...', 'info');
            createPost(processedTitle, processedDescription);
        }
        
        function processTextFormatting(text) {
            // Convert **text** to bold and __text__ to underline
            let processed = text;
            processed = processed.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            processed = processed.replace(/__(.*?)__/g, '<u>$1</u>');
            return processed;
        }

        async function createPost(titleOrContent, description = null) {
            if (!currentUser) {
                addOutput('‚ùå You must be logged in to post.', 'error');
                return;
            }
            
            console.log('Creating post with user:', currentUser);
            console.log('Title/Content:', titleOrContent);
            console.log('Description:', description);
            
            try {
                const postData = {
                    content: description || titleOrContent,
                    title: description ? titleOrContent : null,
                    author: currentUser.displayName || currentUser.email,
                    authorId: currentUser.uid,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    likes: 0,
                    likedBy: [],
                    comments: []
                };
                
                console.log('Post data to save:', postData);
                
                const docRef = await db.collection(POSTS_COLLECTION).add(postData);
                console.log('Post saved with ID:', docRef.id);
                
                // Update user's post count
                await db.collection(USERS_COLLECTION).doc(currentUser.uid).update({
                    postCount: firebase.firestore.FieldValue.increment(1)
                });
                
                addOutput('‚úÖ Post created successfully!', 'success');
                setTimeout(() => loadPosts(), 1000); // Wait a bit for Firebase to sync
            } catch (error) {
                console.error('Error creating post:', error);
                addOutput(`‚ùå Failed to create post: ${error.message}`, 'error');
                
                // Additional debugging
                if (error.code) {
                    addOutput(`Error code: ${error.code}`, 'error');
                }
                
                // Test Firebase connection
                try {
                    await db.collection('test').add({ test: true });
                    addOutput('Firebase connection is working', 'info');
                } catch (testError) {
                    addOutput(`Firebase connection failed: ${testError.message}`, 'error');
                }
            }
        }

        async function loadPosts() {
            console.log('Loading posts...');
            
            try {
                const postsSnapshot = await db.collection(POSTS_COLLECTION)
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                console.log('Posts snapshot size:', postsSnapshot.size);
                
                if (postsSnapshot.empty) {
                    addOutput('üìù No posts yet. Be the first to post!', 'info');
                    return;
                }
                
                addOutput('üìÑ Recent Posts:', 'info');
                addOutput('', '');
                
                postsSnapshot.forEach((doc, index) => {
                    const post = doc.data();
                    const postId = doc.id;
                    const timestamp = post.timestamp ? post.timestamp.toDate().toLocaleString() : 'Just now';
                    
                    console.log('Post data:', post);
                    
                    // Post header
                    addOutput(`ÔøΩ Post #${index + 1} (ID: ${postId})`, 'info');
                    addOutput(`ÔøΩüë§ ${post.author} ‚Ä¢ ${timestamp}`);
                    
                    // Title (if exists)
                    if (post.title) {
                        addOutput(`üìù ${post.title}`);
                    }
                    
                    // Content
                    addOutput(`üí¨ ${post.content}`);
                    
                    // Stats
                    const likesCount = post.likes || 0;
                    const commentsCount = post.comments ? post.comments.length : 0;
                    addOutput(`‚ù§Ô∏è ${likesCount} likes | üí¨ ${commentsCount} comments`);
                    
                    // Recent comments
                    if (post.comments && post.comments.length > 0) {
                        const recentComments = post.comments.slice(-2);
                        recentComments.forEach(comment => {
                            addOutput(`  üí¨ ${comment.author}: ${comment.content}`, 'info');
                        });
                    }
                    
                    addOutput('', ''); // Empty line between posts
                });
                
            } catch (error) {
                console.error('Error loading posts:', error);
                addOutput(`‚ùå Failed to load posts: ${error.message}`, 'error');
                
                // Try to test Firebase connection
                try {
                    const testDoc = await db.collection('test').doc('connection-test').set({
                        test: true,
                        timestamp: new Date()
                    });
                    addOutput('‚úÖ Firebase connection test successful', 'success');
                } catch (testError) {
                    addOutput(`‚ùå Firebase connection failed: ${testError.message}`, 'error');
                }
            }
        }

        // Like and Comment functions
        async function likePost(postId) {
            if (!currentUser) {
                addOutput('‚ùå You must be logged in to like posts.', 'error');
                return;
            }
            
            console.log('Liking post:', postId);
            
            try {
                const postRef = db.collection(POSTS_COLLECTION).doc(postId);
                const postDoc = await postRef.get();
                
                if (!postDoc.exists) {
                    addOutput('‚ùå Post not found.', 'error');
                    return;
                }
                
                const postData = postDoc.data();
                const likedBy = postData.likedBy || [];
                const userAlreadyLiked = likedBy.includes(currentUser.uid);
                
                if (userAlreadyLiked) {
                    // Unlike
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
                    });
                    addOutput('üíî Post unliked!', 'success');
                } else {
                    // Like
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                    });
                    addOutput('‚ù§Ô∏è Post liked!', 'success');
                }
                
                // Reload posts to show updated likes
                setTimeout(() => loadPosts(), 500);
                
            } catch (error) {
                console.error('Error liking post:', error);
                addOutput(`‚ùå Failed to like post: ${error.message}`, 'error');
            }
        }
        
        async function addComment(postId, commentText) {
            if (!currentUser) {
                addOutput('‚ùå You must be logged in to comment.', 'error');
                return;
            }
            
            console.log('Adding comment to post:', postId, 'Text:', commentText);
            
            try {
                const postRef = db.collection(POSTS_COLLECTION).doc(postId);
                const postDoc = await postRef.get();
                
                if (!postDoc.exists) {
                    addOutput('‚ùå Post not found.', 'error');
                    return;
                }
                
                const comment = {
                    author: currentUser.displayName || currentUser.email,
                    authorId: currentUser.uid,
                    content: processTextFormatting(commentText),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await postRef.update({
                    comments: firebase.firestore.FieldValue.arrayUnion(comment)
                });
                
                addOutput('üí¨ Comment added!', 'success');
                
                // Reload posts to show new comment
                setTimeout(() => loadPosts(), 500);
                
            } catch (error) {
                console.error('Error adding comment:', error);
                addOutput(`‚ùå Failed to add comment: ${error.message}`, 'error');
            }
        }

        // Initialize app
        function initializeApp() {
            addOutput('üöÄ DevConsole initialized!', 'success');
        }

        // Start app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
</body>
</html>
